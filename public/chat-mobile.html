<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Nexora" />
  <meta name="theme-color" content="#020617" />
  <meta name="color-scheme" content="dark light" />
  <title>Nexora ‚Äî —á–∞—Ç</title>
  
  <!-- Styles -->
  <link rel="stylesheet" href="/style-mobile.css" />
  <link rel="stylesheet" href="/style-v2.css" />
  
  <style>
    html { background: #020617; }
    html.light { background: #f8fafc; }
  </style>

  <script>
    // Theme loading before paint
    (function() {
      const savedTheme = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const shouldBeLight = savedTheme === 'light' || (!savedTheme && !prefersDark);
      if (shouldBeLight) {
        document.documentElement.classList.add('light');
      }
    })();
  </script>
</head>
<body>
  <div class="app">
    <!-- SIDEBAR: –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ -->
    <aside class="sidebar" id="sidebar">
      <!-- Header -->
      <div class="sidebar-header">
        <div class="logo-circle">‚ú®</div>
        <div class="logo-text">
          <div class="logo-name">Nexora</div>
          <div class="logo-subtitle">–º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä</div>
        </div>
      </div>

      <!-- Current User Profile -->
      <div class="current-user" id="profile-link" title="–û—Ç–∫—Ä—ã—Ç—å –ø—Ä–æ—Ñ–∏–ª—å">
        <span class="current-user-label">–í—ã:</span>
        <span class="current-user-name" id="current-username">...</span>
      </div>

      <!-- Theme Toggle -->
      <button id="theme-toggle" class="btn-ghost" style="width: 100%;" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">
        <span id="theme-icon">üåô</span> <span id="theme-text">–¢–µ–º–Ω–∞—è</span>
      </button>

      <!-- Actions: Nexus & Create -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
        <button id="nexus-btn" class="btn-secondary" title="–ù–∞–π—Ç–∏ –Ω–µ–∫—Å—É—Å—ã" style="width: 100%;">
          üîç –ù–µ–∫—Å—É—Å—ã
        </button>
        <button id="create-btn" class="btn-secondary" title="–°–æ–∑–¥–∞—Ç—å —á–∞—Ç" style="width: 100%;">
          ‚ûï –°–æ–∑–¥–∞—Ç—å
        </button>
      </div>

      <!-- Admin Panel (hidden by default) -->
      <a
        id="admin-panel-btn"
        href="/admin.html"
        class="btn-primary"
        style="width: 100%; display: none; text-align: center; text-decoration: none; margin-top: 8px;"
        title="–ü–µ—Ä–µ–π—Ç–∏ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å"
      >
        ‚öôÔ∏è –ê–¥–º–∏–Ω
      </a>

      <!-- Chats List Title -->
      <div style="font-size: 11px; color: var(--light-text-muted); text-transform: uppercase; letter-spacing: 0.1em; margin: 12px 0 8px; font-weight: 600;">
        üí¨ –ß–∞—Ç—ã
      </div>

      <!-- Chats List -->
      <ul class="chat-list" id="chat-list"></ul>

      <!-- Footer Actions (hidden) -->
      <div style="display: none; margin-top: auto; padding-top: 12px; border-top: 1px solid var(--border-color); display: flex; flex-direction: column; gap: 8px;">
        <form action="/logout" method="POST" style="width: 100%;">
          <button type="submit" class="btn-secondary" style="width: 100%;">–í—ã–π—Ç–∏</button>
        </form>
        <form
          action="/delete-account"
          method="POST"
          onsubmit="return confirm('–¢–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å? –ù–µ–æ–±—Ä–∞—Ç–∏–º–æ.');"
          style="width: 100%;"
        >
          <button type="submit" class="btn-ghost" style="width: 100%;">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
        </form>
      </div>
    </aside>

    <!-- MAIN CHAT AREA -->
    <main class="chat-main" id="chat-main">
      <!-- Header -->
      <div class="chat-main-header">
        <button id="back-btn" class="back-btn" type="button" title="–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —á–∞—Ç–∞–º">
          ‚Üê –ß–∞—Ç—ã
        </button>
        <div class="chat-main-title" id="chat-title" title="–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —á–∞—Ç–µ">
          üí¨ –í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç
        </div>
      </div>

      <div class="chat-main-subtitle" id="chat-subtitle">
        –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —á–∞—Ç —Å–ª–µ–≤–∞ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π
      </div>

      <!-- Messages Container -->
      <section id="messages" class="chat-main-messages" role="log" aria-label="–°–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞"></section>

      <!-- Input Area -->
      <form id="chat-form" class="chat-main-input" role="form">
        <input type="file" id="file-input" style="display: none;" accept="image/*,video/*,audio/*,.pdf,.doc,.docx,.txt,.zip,.rar" />
        
        <button type="button" id="attach-btn" class="input-icon-btn" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∞–π–ª" aria-label="–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∞–π–ª">
          üìé
        </button>
        
        <button type="button" id="record-btn" class="input-icon-btn" title="–ì–æ–ª–æ—Å–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ" aria-label="–ó–∞–ø–∏—Å–∞—Ç—å –≥–æ–ª–æ—Å">
          üéôÔ∏è
        </button>
        
        <button type="button" id="sticker-btn" class="input-icon-btn" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Ç–∏–∫–µ—Ä" aria-label="–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å—Ç–∏–∫–µ—Ä">
          üè∑Ô∏è
        </button>
        
        <input
          id="message-input"
          type="text"
          placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
          autocomplete="off"
          spellcheck="true"
          aria-label="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"
        />
        
        <button type="submit" class="input-send-btn" id="send-btn" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å" aria-label="–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ">
          ‚¨ÜÔ∏è
        </button>
      </form>
    </main>
  </div>

  <!-- Modals & Dialogs -->
  <div id="profile-modal" class="modal" role="dialog" aria-labelledby="profile-modal-title" aria-modal="true"></div>
  <div id="sticker-modal" class="modal" role="dialog" aria-labelledby="sticker-modal-title" aria-modal="true"></div>
  <div id="nexus-modal" class="modal" role="dialog" aria-labelledby="nexus-modal-title" aria-modal="true"></div>
  <div id="create-chat-modal" class="modal" role="dialog" aria-labelledby="create-modal-title" aria-modal="true"></div>
  <div id="confirm-modal" class="modal" role="alertdialog" aria-labelledby="confirm-title" aria-modal="true"></div>

  <!-- Scripts -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="/theme-toggle.js" defer></script>
  <script src="/chat-app.js" defer></script>
</body>
</html>
